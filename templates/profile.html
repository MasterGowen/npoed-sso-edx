{% extends "base.html" %}
{% load static from staticfiles %}
{% load backend_utils %}

{% block extra_css %}
  <link href="{% static 'css/edx-theme.css' %}" rel="stylesheet" type="text/css" />
{% endblock extra_css %}

{% block bodyclass %}section-profile{% endblock %}

{% block content %}
<div class="content-wrapper">

  <h1 class="firstDocumentHeading">Профиль</h1>

  {% if user.is_authenticated %}

    <ul class="profile-nav">
      <li>Мои данные</li>
      <li><a href="{% url 'password_change' %}">Сменить пароль</a></li>
      <li><a href="#">Социальные сети</a></li>
      <!-- <li><a href="{% url 'edx-push' pk=user.id %}">Push to edx</a></li> -->
    </ul>

    <div class="profile-content-wrapper profile-connect-social-network">
      <h5>Привязать аккаунт</h5>
      {% for sublist in available_backends|social_backends %}
        {% for name, backend in sublist %}
          {% associated backend %}
          {% if association %}
            <form method="POST" action="{% url 'social:disconnect_individual' backend=association.provider association_id=association.id %}?next={{ request.path }}">
              {% csrf_token %}
              <input type="submit" value="disconnect {{ name }}">
            </form>
          {% else %}
            <a class="custom_img-thumbnail_link link-{{ name }}" href="{% url 'social:begin' backend=name %}?next={{ request.path }}"><span>Подключить {{ name }}</span></a>
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>

    <form method="post" class="profile-content-wrapper">
      {% csrf_token %}
      <table>
        {{ form.as_table }}
      </table>
      <div class="footer-buttons">
        <button class="btn btn-primary" type="submit">Сохранить изменения</button>
      </div>
    </form>

  {% else %}

    <p>Вы должны быть авторизованы для просмотра вашего профиля.</p>

  {% endif %}

</div>
{% endblock content %}
